<html>
  <head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0"/>
    <style>
      body {
        background: linear-gradient(
          135deg,
          white 0%,
          white 49%,
          black 49%,
          black 51%,
          white 51%,
          white 100%
        );
        background-repeat: repeat;
        background-size: 20px 20px;
        overflow: hidden;
        padding: 0px;
        margin: 0px;
      }
      canvas {
        background-color: white;
      }
    </style>
    <script src='https://surikov.github.io/webaudiofont/npm/dist/WebAudioFontPlayer.js'></script>
    <script>
      var AudioContextFunc = window.AudioContext || window.webkitAudioContext;
      var audioContext = new AudioContextFunc();
      var player=new WebAudioFontPlayer();
      var channels = new Map();

      function play_note(channel, semitones, seconds, volume){
        const info = channels.get(channel);
        if (info) {
          player.queueWaveTable(audioContext, audioContext.destination, window[info.variable], 0, semitones, seconds, volume);
        }
      }

      function init_channel(channel, program) {
        var nn = player.loader.findInstrument(program);
        var info = player.loader.instrumentInfo(nn);
        channels.set(channel, info);
        console.log('init_channel(', channel, program, ') -> info:', info);
        player.loader.startLoad(audioContext, info.url, info.variable);
      }

      function load_instruments() {
        player.loader.waitLoad(function () {
          console.log('load_instruments: finished', channels);
        });
      }
    </script>
  </head>
  <script type="module">
    import init from './target/wasm.js'
    init()
  </script>
</html>
